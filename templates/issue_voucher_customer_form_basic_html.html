<!DOCTYPE html> 
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Issue Voucher</title>
    <style> body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#0f172a;color:#e5e7eb;display:grid;place-items:center;min-height:100vh;padding:24px;} .card{width:min(560px,92vw);background:#0b1220;border:1px solid #1f2937;border-radius:18px;padding:24px;box-shadow:0 12px 28px rgba(0,0,0,.45);} h1{margin:0 0 4px;} p.sub{margin:0 0 18px;color:#94a3b8;font-size:13px;} .field{display:grid;gap:6px;margin-bottom:12px;} label{font-size:12px;color:#94a3b8;} input,select{width:100%;background:#081224;color:#e5e7eb;border:1px solid #1f2937;border-radius:12px;padding:12px;outline:none;} input:focus,select:focus{border-color:#2563eb;box-shadow:0 0 0 4px rgba(37,99,235,.35);} .actions{display:flex;justify-content:flex-end;gap:10px;margin-top:10px;} .btn{cursor:pointer;border:none;padding:12px 16px;border-radius:12px;font-weight:700;} .btn.primary{background:linear-gradient(180deg,#22c55e,#16a34a);color:#06220f;} .result{margin-top:14px;background:#07101f;border:1px dashed #1f2a3d;padding:12px;border-radius:12px;display:none;white-space:pre-wrap;} </style>
    <style>
.back-btn {
  display: inline-block;
  padding: 8px 16px;
  background: #6c63ff;
  color: white;
  text-decoration: none;
  border-radius: 6px;
  transition: background 0.2s;
}
.back-btn:hover {
  background: #574fd6;
}
</style>

  </head>
  <body>


    <div class="card">
      <div style="margin-bottom: 15px;">
    <a href="{{ url_for('index') }}" 
       style="display: inline-block; padding: 8px 16px; background: #6c63ff; color: white; text-decoration: none; border-radius: 6px;">
       ← Back to Dashboard
    </a>
</div>
      <h1>Issue Voucher</h1>
      <p class="sub">Fill Partner details to generate voucher</p>
      <form id="issueForm" autocomplete="on">
  <div class="field">
    <label for="name">Partner Name</label>
    <input id="name" name="name" required />
  </div>
  <div class="field">
    <label for="mobile">Partner Mobile Number</label>
    <input id="mobile" name="mobile" />
  </div>
  <div class="field">
    <label for="mobile">Issued Bill Number</label>
    <input id="bill" name="bill" required />
  </div>
  <div class="field">
    <label for="outlet">Outlet</label>
    
     <select id="outlet" name="outlet" readonly>
  <option value="{{ outlet }}">{{ outlet }}</option>
</select>

  </div>
  <div class="actions">
    <button type="submit" class="btn primary" id="submitBtn">Generate Voucher</button>
  </div>
</form>

<div id="result" class="result"></div>

    </div>
  <script>
const form = document.getElementById('issueForm');
const resultBox = document.getElementById('result');
const button = document.getElementById("submitBtn");


form.addEventListener('submit', async (e) => {
  e.preventDefault();
  button.disabled = true;
  button.innerText = "Processing...";
  const formData = new FormData(form);
  const payload = Object.fromEntries(formData.entries());

  if (!payload.name || !payload.outlet) {
    alert("Please fill all fields");
    return;
  }

  try {
    const res = await fetch('/issue', {
      method: 'POST',
      body: formData
    });

    const data = await res.json();
    resultBox.style.display = 'block';

    if (data.status === 'success') {
      const bill = data.bill;
      const outlet = data.outlet;
      const downloadURL = `/voucher_download/${data.code}/${outlet}/${data.name}/234`;
      resultBox.innerHTML = `
        <b>Voucher Created ✅</b><br>
        Code: ${data.code}<br>
        <a href="${downloadURL}" target="_blank"
           style="text-decoration:none;background:#2563eb;color:white;padding:10px 16px;border-radius:10px;display:inline-block;margin-top:10px;">
           ⬇️ Download Voucher
        </a>`;
    } else {
      resultBox.innerHTML = `<span style="color:red;">❌ ${data.message}</span>`;
    }
  } catch (err) {
    console.error(err);
    alert("Server error — check Flask logs.");
  }
});
</script>
  </body>
</html>
